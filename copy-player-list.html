<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Copy Player List</title>
<style>
  :root { --bg:#ffffff; --btn:#9900FF; }
  html,body{min-height:100%;margin:0;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
  /* 20% from top, centered horizontally */
  #copyBtn,#done,#hint{position:absolute;left:50%;transform:translateX(-50%)}
  #copyBtn{top:20vh}
  #done{top:calc(20vh + 56px);display:none;font-weight:600;font-size:1.05rem;color:#222}
  #hint{top:calc(20vh + 92px);display:none;font-size:.95rem;color:#444}
  button{padding:1rem 2rem;font-size:1.1rem;font-weight:600;color:#fff;background:var(--btn);
    border:none;border-radius:12px;cursor:pointer;box-shadow:0 6px 20px rgba(0,0,0,.2);
    transition:transform .15s, box-shadow .15s}
  button:hover{transform:translateX(-50%) translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.25)}
  button:active{transform:translateX(-50%) translateY(1px);box-shadow:0 4px 12px rgba(0,0,0,.2)}
</style>
</head>
<body>
  <button id="copyBtn">üìù Copy Players List</button>
  <div id="done">‚úÖ Copied to clipboard!</div>
  <div id="hint">Tap the button once to allow copying.</div>

<script>
(() => {
  // Accept ?players=... OR #... (and strip extra params after &)
  const params = new URLSearchParams(location.search);
  const qp = params.get('players');
  let fromHash = location.hash.startsWith('#') ? location.hash.slice(1) : '';
  if (fromHash.includes('&')) fromHash = fromHash.split('&')[0];

  const raw = decodeURIComponent(qp || fromHash || '');
  const names = raw.split(',').map(s=>s.trim()).filter(Boolean);

  const short = names.map(full => {
    const parts = full.replace(/\s+/g,' ').trim().split(' ');
    if (parts.length < 2) return parts[0];
    const last = parts[parts.length - 1];
    const m = (last.match(/[A-Za-z]/) || [''])[0].toUpperCase();
    return m ? `${parts[0]} ${m}.` : parts[0];
  });

  const text = short.map((n,i)=>`${i+1}. ${n}`).join('\n') || '';

  const copyBtn = document.getElementById('copyBtn');
  const done = document.getElementById('done');
  const hint = document.getElementById('hint');

  async function copyOnce() {
    // modern API
    try {
      if (navigator.clipboard?.writeText) {
        await navigator.clipboard.writeText(text);
        return true;
      }
    } catch(e){}
    // legacy fallback
    try {
      const ta = document.createElement('textarea');
      ta.value = text; ta.style.position='fixed'; ta.style.opacity='0';
      document.body.appendChild(ta); ta.select();
      const ok = document.execCommand('copy');
      ta.remove();
      return !!ok;
    } catch(e){ return false; }
  }

  function showSuccessAndClose() {
    copyBtn.style.display = 'none';
    done.style.display = 'block';
    // Clear hash/search so repeat clicks always reload fresh
    history.replaceState(null,'',location.pathname);
    setTimeout(()=>{ window.close(); location.replace('about:blank'); }, 700);
  }

  async function autoTry() {
    if (!text) { hint.textContent = 'No players found.'; hint.style.display='block'; return; }
    const ok = await copyOnce();
    if (ok) { showSuccessAndClose(); }
    else { hint.style.display = 'block'; } // require one user tap now
  }

  // Try once on load; only close if it *really* copied
  autoTry();

  // One-tap fallback
  copyBtn.addEventListener('click', async () => {
    const ok = await copyOnce();
    if (ok) showSuccessAndClose();
  }, { once:true });
})();
</script>
</body>
</html>
